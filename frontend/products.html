<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Products</title>
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>
<div class="container">
  <h2>Products</h2>

  <nav>
    <a href="index.html">Home</a>
    <a href="orders.html">Orders</a>
    <a href="login.html">Login</a>
    <a href="register.html">Register</a>
    <a href="admin.html">Admin</a>
  </nav>

  <div style="margin: 10px 0;">
    <input id="q" placeholder="Search (name)" />
    <button onclick="loadProducts(1)">Search</button>
  </div>

  <ul id="products"></ul>

  <div style="margin-top:10px;">
    <button onclick="prev()">Prev</button>
    <span id="pageInfo"></span>
    <button onclick="next()">Next</button>
  </div>
</div>

<script>
  const API = 'http://localhost:3000';
  let page = 1;
  const limit = 20;
  let total = 0;

  function render(items) {
    const list = document.getElementById('products');
    list.innerHTML = '';
    items.forEach(p => {
      const li = document.createElement('li');
      const cat = p.category?.name ? ` | ${p.category.name}` : '';
      const sup = p.supplier?.name ? ` | ${p.supplier.name}` : '';
      li.textContent = `${p.name} - $${p.price} (stock: ${p.stock})${cat}${sup}`;
      list.appendChild(li);
    });
  }

  function loadProducts(newPage) {
    page = newPage;
    const q = document.getElementById('q').value.trim();
    const url = new URL(API + '/api/products');
    url.searchParams.set('page', page);
    url.searchParams.set('limit', limit);
    if (q) url.searchParams.set('q', q);

    fetch(url)
            .then(res => res.json())
            .then(data => {
              total = data.total || 0;
              render(data.items || []);
              document.getElementById('pageInfo').textContent =
                      `page ${data.page} / ${Math.max(1, Math.ceil(total / limit))} (total: ${total})`;
            })
            .catch(() => {
              document.getElementById('products').innerHTML = '<li>Failed to load products. Is backend running?</li>';
            });
  }

  function prev() {
    if (page > 1) loadProducts(page - 1);
  }
  function next() {
    if (page < Math.ceil(total / limit)) loadProducts(page + 1);
  }

  loadProducts(1);
</script>
</body>
</html>
